# Invoke (pyinvoke.org) tab-completion script to be sourced with the Z shell.
# Known to work on zsh 5.0.x, probably works on later 4.x releases as well.

_complete_invoke() {
    # `words` contains the entire command string up til now (including
    # program name).
    #
    # We hand it to Invoke so it can figure out the current context: spit back
    # core options, task names, the current task's options, or some combo.
    #
    # `reply` is the array of valid completions handed back to `compctl`.
    reply=( $(invoke --complete -- ${words}) )
}


# Tell shell builtin to use the above for completing 'inv'/'invoke':
# * -K: use given function name to generate completions.
# * -f: when function generates no results, use filenames.
# * positional args: program names to complete for.
compctl -K _complete_invoke inv invoke

# vim: set ft=sh :
